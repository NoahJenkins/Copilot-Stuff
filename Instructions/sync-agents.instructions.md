# Sync Agent Instructions from GitHub Copilot

Mirror `.github/copilot-instructions.md` (and any `.github/instructions/*.instructions.md` files)
into the canonical instruction files for Claude Code, Gemini CLI, and OpenAI Codex.

## Your Task

Execute the following steps **in order**, creating or overwriting files as needed.
Never delete `.github/copilot-instructions.md` or anything inside `.github/`.

---

### Step 1 — Read the source of truth

Read `.github/copilot-instructions.md` and store its full content.

If the file does not exist, stop and tell the user:
> "No `.github/copilot-instructions.md` found. Please create this file first — it is the source of truth for all AI agent instructions."

Also scan `.github/instructions/` for any `*.instructions.md` files.
For each one, record its filename, `applyTo` frontmatter (if present), and body content.

---

### Step 2 — Create directory scaffolding

```bash
mkdir -p .claude/commands
mkdir -p .gemini
# AGENTS.md goes at repo root (no subdirectory needed for Codex)
```

---

### Step 3 — Write `CLAUDE.md` (Claude Code)

Create or overwrite `CLAUDE.md` at the repo root with this structure:

```
<!--
  ╔══════════════════════════════════════════════════════════════╗
  ║  AUTO-SYNCED — DO NOT EDIT THIS FILE DIRECTLY               ║
  ║  Source of truth: .github/copilot-instructions.md           ║
  ║  To update: run /sync-agents.instructions in Claude Code     ║
  ╚══════════════════════════════════════════════════════════════╝
-->

# Claude Code Instructions

> **Source of truth:** [`.github/copilot-instructions.md`](.github/copilot-instructions.md)
>
> This file is automatically generated by the `/sync-agents.instructions` command.
> To propagate changes, update `.github/copilot-instructions.md` and re-run that command.

---

[INSERT FULL CONTENT OF .github/copilot-instructions.md HERE]
```

If there are path-specific `.github/instructions/*.instructions.md` files, also create
matching `.claude/instructions/` files in the same structure, each with a header:
```
<!-- Synced from .github/instructions/<filename>.instructions.md — do not edit directly -->
```
followed by the body content of the source file (strip the applyTo frontmatter — Claude Code
does not use it; include it as a plain markdown comment instead so context is preserved).

---

### Step 4 — Write `GEMINI.md` (Gemini CLI)

Create or overwrite `GEMINI.md` at the repo root.

Gemini CLI natively supports the `@path/to/file.md` import syntax, which causes it to
**dynamically load the referenced file at runtime** — meaning GEMINI.md will always reflect
the current state of `.github/copilot-instructions.md` without needing to re-run this command.

Write exactly this content (substituting any existing path-specific file imports below):

```markdown
<!--
  ╔══════════════════════════════════════════════════════════════╗
  ║  SOURCE OF TRUTH: .github/copilot-instructions.md           ║
  ║  This file uses Gemini CLI's native @import syntax so it    ║
  ║  always loads the latest copilot instructions at runtime.   ║
  ║  Run /sync-agents.instructions to update path-specific files.║
  ╚══════════════════════════════════════════════════════════════╝
-->

# Gemini CLI Instructions

> **Source of truth:** `.github/copilot-instructions.md`
> This file dynamically imports from Copilot's instruction file using Gemini's
> `@file` syntax. Any edits to `.github/copilot-instructions.md` are reflected
> here automatically — no manual sync required.

@.github/copilot-instructions.md
```

If there are `.github/instructions/*.instructions.md` files, append additional imports
after the main import, one per line in the format `@.github/instructions/<filename>.instructions.md`,
preceded by a comment noting what the file covers (extract from the applyTo value or filename).

If there are also subdirectory-specific instructions (files with an `applyTo` pointing to a
specific directory), create matching `GEMINI.md` files inside those directories using the same
`@` import syntax pointing back to the original `.github/instructions/` file.

---

### Step 5 — Write `AGENTS.md` (OpenAI Codex)

Create or overwrite `AGENTS.md` at the repo root with this structure:

```
<!--
  ╔══════════════════════════════════════════════════════════════╗
  ║  AUTO-SYNCED — DO NOT EDIT THIS FILE DIRECTLY               ║
  ║  Source of truth: .github/copilot-instructions.md           ║
  ║  To update: run /sync-agents.instructions in Claude Code     ║
  ╚══════════════════════════════════════════════════════════════╝
-->

# Codex Agent Instructions

> **Source of truth:** [`.github/copilot-instructions.md`](.github/copilot-instructions.md)
>
> This file is automatically generated by the `/sync-agents.instructions` command.
> To propagate changes, update `.github/copilot-instructions.md` and re-run that command.

---

[INSERT FULL CONTENT OF .github/copilot-instructions.md HERE]
```

For each `.github/instructions/*.instructions.md` file that has an `applyTo` targeting a
specific subdirectory path, create a corresponding `AGENTS.md` inside that subdirectory
with the same structure and a note indicating it was synced from that instructions file.

Codex reads one `AGENTS.md` per directory level and merges them top-down, so subdirectory
files will correctly scope their overrides.

---

### Step 6 — Verify and report

After writing all files, list every file created or updated and confirm:

```
✅ Sync complete. Files written:
  - CLAUDE.md                        (Claude Code root instructions)
  - .claude/instructions/<files>     (if path-specific files existed)
  - GEMINI.md                        (Gemini CLI — live @import link)
  - .gemini/<subdir>/GEMINI.md       (if path-specific files existed)
  - AGENTS.md                        (OpenAI Codex root instructions)
  - <subdir>/AGENTS.md              (if path-specific files existed)

Source of truth: .github/copilot-instructions.md
To keep agents in sync, run /sync-agents.instructions after any Copilot instruction update.
```

---

## Agent Instruction File Reference

| Agent | Primary File | Format | Notes |
|---|---|---|---|
| GitHub Copilot | `.github/copilot-instructions.md` | Markdown | **Source of truth** |
| Claude Code | `CLAUDE.md` | Markdown | Copied at sync time |
| Gemini CLI | `GEMINI.md` | Markdown + `@imports` | Live import — no re-sync needed |
| OpenAI Codex | `AGENTS.md` | Markdown | Copied at sync time |

---

## Docs references used to build this command

- **Claude Code** memory/instructions: https://docs.anthropic.com/en/docs/claude-code/memory
- **Gemini CLI** GEMINI.md + `@import`: https://google-gemini.github.io/gemini-cli/docs/cli/gemini-md.html
- **OpenAI Codex** AGENTS.md: https://developers.openai.com/codex/guides/agents-md/
- **GitHub Copilot** custom instructions: https://docs.github.com/copilot/customizing-copilot/adding-custom-instructions-for-github-copilot